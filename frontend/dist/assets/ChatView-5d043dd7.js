import{r as c,u as T,q as C,w as S,o as n,c as u,a as e,F as _,z,y as p,B as A,C as V,D,A as m,E as M,G as w,n as E}from"./index-83dc066c.js";import{r as O}from"./PaperAirplaneIcon-f7da5b5a.js";const j="/assets/icons8-chatgpt-240-e32b4819.png",N={class:"max-w-4xl mx-auto px-8 py-6 flex gap-6"},$=["src"],q={class:"prose"},F={class:"bg-gray-50"},G={class:"max-w-4xl mx-auto px-8 py-6 flex gap-6"},H=e("img",{class:"inline-block h-10 w-10 p-1.5 rounded-full bg-blue-600",src:j,alt:""},null,-1),I={class:"prose"},L={key:0,class:"w-full border-t"},J={class:"max-w-4xl mx-auto px-8 py-8"},P=["onSubmit"],R={type:"submit"},U={key:0,class:"w-6 h-6 text-blue-600 animate-spin",fill:"none",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},W=e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),K=e("path",{class:"opacity-75",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z",fill:"currentColor"},null,-1),Q=[W,K],ee={__name:"ChatView",props:{sidebarOpen:{require:!1}},setup(x){const y=c(x.sidebarOpen),{getAccessTokenSilently:f,user:v}=T(),h=C();let t=c([]);const i=c(""),a=c(!1),d=c(null),g=()=>{d.value&&(d.value.scrollTop=d.value.scrollHeight)},b=async()=>{if(!a.value){a.value=!0;try{t.value.push({message:i.value,answer:""});const o=h.params.id,r=await f(),l=await(await fetch("/api/message",{method:"POST",redirect:"follow",headers:{Authorization:`Bearer ${r}`,"Content-Type":"application/json"},body:JSON.stringify({userId:v._rawValue.sub,chatId:o,message:i.value})})).json();if(l){const k=t.value.filter(B=>B.answer!=="");t.value=k,t.value.push(l),g(),y.value=!1,i.value="",a.value=!1}}catch(o){a.value=!1,console.log(o.message)}}};return S(async()=>{const o=h.params.id,r=await f(),l=await(await fetch(`/api/message/${o}`,{method:"GET",redirect:"follow",headers:{Authorization:`Bearer ${r}`}})).json();t.value=l,await E(),g()}),(o,r)=>(n(),u(_,null,[e("div",{ref_key:"scrollableDiv",ref:d,style:{overflow:"auto"}},[(n(!0),u(_,null,z(p(t),(s,l)=>(n(),u("div",{key:l},[e("div",null,[e("div",N,[e("img",{class:"inline-block h-10 w-10 rounded-full",src:p(v).picture,alt:""},null,8,$),e("article",q,w(s.message),1)]),e("div",F,[e("div",G,[H,e("article",I,w(s.answer?s.answer:"Loading . . ."),1)])])])]))),128))],512),p(h).params.id?(n(),u("div",L,[e("div",J,[e("form",{onSubmit:A(b,["prevent"]),class:"border rounded-lg px-6 py-4 flex items-center"},[V(e("input",{"onUpdate:modelValue":r[0]||(r[0]=s=>i.value=s),placeholder:"Send a message",class:"m-0 w-full resize-none border-0 bg-transparent p-0 pr-10 focus:ring-0 focus-visible:ring-0 dark:bg-transparent md:pr-12 pl-3 md:pl-0",style:{"max-height":"200px",height:"24px","overflow-y":"hidden"},tabindex:"0",name:"prompt",id:"prompt",rows:"1"},null,512),[[D,i.value]]),e("button",R,[a.value?(n(),u("svg",U,Q)):m("",!0),a.value?m("",!0):(n(),M(p(O),{key:1,class:"h-6 cursor-pointer text-gray-500 hover:text-gray-900"}))])],40,P)])])):m("",!0)],64))}};export{ee as default};
